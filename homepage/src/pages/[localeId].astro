---
import getQuery from '../data/query'
// import Homepage from '../components/Homepage';
import Homepage from '../components/Homepage.astro';

import DefaultLayout from '../layouts/DefaultLayout.astro'


export async function getStaticPaths() {

  const response = await fetch(import.meta.env.API_URL,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        query: getQuery(import.meta.env.SURVEY),
      }),
    })

  const json = await response.json();
  if (json.errors) {
    throw new Error(json.errors[0].message)
  }
  const { surveys, locales } = json.data

  return json.data.locales.map(locale => ({ params: { localeId: locale.id }, props: { locale, locales, surveys } }))
}

const { locale, locales, surveys } = Astro.props

const survey = surveys.find(s => s?.slug === import.meta.env.SURVEY)

const props = { survey, locale, locales }
---

<DefaultLayout {...props}>
  <Homepage client:load {...props} />
</DefaultLayout>